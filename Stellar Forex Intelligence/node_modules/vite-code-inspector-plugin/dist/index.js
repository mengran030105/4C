"use strict";var P=Object.defineProperty,v=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var o=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var p=(e,t,n)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,f=(e,t)=>{for(var n in t||(t={}))x.call(t,n)&&p(e,n,t[n]);if(o)for(var n of o(t))j.call(t,n)&&p(e,n,t[n]);return e},d=(e,t)=>v(e,C(t));var h=(e,t,n)=>new Promise((l,a)=>{var m=r=>{try{i(n.next(r))}catch(s){a(s)}},g=r=>{try{i(n.throw(r))}catch(s){a(s)}},i=r=>r.done?l(r.value):Promise.resolve(r.value).then(m,g);i((n=n.apply(e,t)).next())});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("code-inspector-core"),W="vite-code-inspector-plugin",T=["isJsx","isTsx","lang.jsx","lang.tsx"];function b(e){const t={port:0,entry:"",output:e.output};return d(f({name:W},e.enforcePre===!1?{}:{enforce:"pre"}),{apply(l,{command:a}){return!(e!=null&&e.close)&&c.isDev(e.dev,a==="serve")},transform(l,a){return h(this,null,function*(){if(a.match("node_modules")){if(!c.matchCondition(e.include||[],a))return l}else l=yield c.getCodeWithWebComponent({options:e,file:a,code:l,record:t});const{escapeTags:m=[],mappings:g}=e||{},[i]=a.split("?",2);let r=c.normalizePath(i);r=c.getMappingFilePath(r,g);const s=new URLSearchParams(a);if(e!=null&&e.match&&!e.match.test(r))return l;let u="";return c.isJsTypeFile(r)||r.endsWith(".vue")&&(T.some(y=>s.get(y)!==null)||s.get("lang")==="tsx"||s.get("lang")==="jsx")?u="jsx":r.endsWith(".vue")&&s.get("type")!=="style"&&s.get("raw")===null?u="vue":r.endsWith(".svelte")&&(u="svelte"),u?c.transformCode({content:l,filePath:r,fileType:u,escapeTags:m}):l})},transformIndexHtml(l){return h(this,null,function*(){const a=yield c.getCodeWithWebComponent({options:d(f({},e),{importClient:"code"}),file:"main.js",code:"",record:t,inject:!0});return l.replace("<head>",'<head><script type="module">\n'.concat(a,"\n<\/script>"))})}})}exports.ViteCodeInspectorPlugin=b;
