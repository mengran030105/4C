"use strict";var f=(s,u,i)=>new Promise((a,l)=>{var d=t=>{try{r(i.next(t))}catch(n){l(n)}},e=t=>{try{r(i.throw(t))}catch(n){l(n)}},r=t=>t.done?a(t.value):Promise.resolve(t.value).then(d,e);r((i=i.apply(s,u)).next())});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("code-inspector-core"),C=require("fs"),h=require("path"),v="esbuild-code-inspector-plugin";function b(s){return{name:v,setup(u){if(s.close||!o.isDev(s.dev,!1))return;const i={port:0,entry:"",output:s.output},{escapeTags:a=[]}=s,l=new Map;u.onLoad({filter:s.match||/\.(jsx|tsx|js|ts|mjs|mts)?$/},d=>f(this,null,function*(){let e=d.path;e=o.getMappingFilePath(e,s.mappings);let r=yield C.promises.readFile(e,"utf8"),t=l.get(e);if(!t||t.originCode!==r){let n=r;if(e.match("node_modules")){if(!o.matchCondition(s.include||[],e))return n}else n=yield o.getCodeWithWebComponent({options:s,file:e,code:n,record:i});let c="";if(o.isJsTypeFile(e)?c="jsx":e.endsWith(".svelte")&&(c="svelte"),c)n=o.transformCode({content:n,filePath:e,fileType:c,escapeTags:a});else if(e.endsWith(".vue")){c="vue";const{descriptor:p}=o.parseSFC(n,{sourceMap:!1}),g=o.transformCode({content:p.template.content,filePath:e,fileType:c,escapeTags:a});n=n.replace(p.template.content,g)}const m=h.extname(e).replace(".","");t={originCode:r,output:{contents:n,loader:m}},l.set(e,t)}return t.output}))}}}exports.EsbuildCodeInspectorPlugin=b;
